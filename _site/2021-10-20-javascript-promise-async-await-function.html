<h1 id="promise-asyncawait-functions">Promise Async/Await Functions</h1>

<p>In javascript there are 2 ways to tame the asynchronous beast. You need to use the following Functions:</p>

<ul>
  <li><strong>Promise (then/catch) introduced in ES6</strong></li>
  <li><strong>Async/Await introduced in ES7</strong></li>
</ul>

<p>These 2 syntaxes gives exactly same underlying functionality, however the readability and scope is different. We will explore how they helps us in generating maintainable code, while other functions make chaos :boom: .</p>

<p>In this snippet we will see in example how we can relate the daily household task into JS understanding.</p>

<p>JavaScript runs code line by line, moving to the next line of code only after the previous one has been executed. But executing code like this can only take us so far. Sometimes, we need to perform tasks that take a long or unpredictable amount of time to complete: fetching data or triggering side-effects via an API, for example.</p>

<p>Rather than letting these tasks block JavaScript’s main thread, the language allows us to run certain tasks in parallel. ES6 saw the introduction of the Promise object as well as new methods to handle the execution of these Promises: <code class="highlighter-rouge">then</code>, <code class="highlighter-rouge">catch</code>, and <code class="highlighter-rouge">finally</code>. But a year later, in ES7, the language added another approach and two new keywords: <code class="highlighter-rouge">async</code> and <code class="highlighter-rouge">await</code>.</p>

<p>In my opinion, unless a library or legacy codebase forces you to use <code class="highlighter-rouge">then/catch</code>, the better choice for readability and maintainability is <code class="highlighter-rouge">async/await</code>. To demonstrate that, we’ll use both syntaxes to solve the daily household tasks.</p>

<h1 id="then-catch-and-finally">then, catch And finally</h1>

<p><code class="highlighter-rouge">then</code> and <code class="highlighter-rouge">catch</code> and <code class="highlighter-rouge">finally</code> are methods of the Promise object, and they are chained one after the other. Each takes a callback function as its argument and returns a Promise.</p>

<p>As example:</p>

<div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
</pre></td><td class="rouge-code"><pre><span class="c1">// First you need to buy some vegges from grocery</span>
<span class="kd">const</span> <span class="nx">grocery</span> <span class="o">=</span> <span class="k">new</span> <span class="nb">Promise</span><span class="p">(</span>
  <span class="p">(</span><span class="nx">resolve</span><span class="p">,</span> <span class="nx">reject</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>
    <span class="k">if</span><span class="p">(</span><span class="nx">shopOpen</span><span class="p">){</span>
      <span class="nx">resolve</span><span class="p">(</span><span class="s1">'buy the grocery'</span><span class="p">);</span>
    <span class="p">}</span><span class="k">else</span><span class="p">{</span>
      <span class="nx">reject</span><span class="p">(</span><span class="s1">'it is a holiday, shop closed'</span><span class="p">);</span>
    <span class="p">}</span>
  <span class="p">}</span>
<span class="p">);</span>

<span class="c1">// Then you need to chop the vegges into pieces</span>
<span class="kd">const</span> <span class="nx">chopping</span> <span class="o">=</span> <span class="k">new</span> <span class="nb">Promise</span><span class="p">(</span>
  <span class="p">(</span><span class="nx">resolve</span><span class="p">,</span> <span class="nx">reject</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>
    <span class="nx">resolve</span><span class="p">(</span><span class="s1">'vegges are chopped'</span><span class="p">);</span>
  <span class="p">}</span>
<span class="p">);</span>

<span class="c1">// Finally you can cook the food</span>
<span class="kd">const</span> <span class="nx">cooking</span> <span class="o">=</span> <span class="k">new</span> <span class="nb">Promise</span><span class="p">(</span>
  <span class="p">(</span><span class="nx">resolve</span><span class="p">,</span> <span class="nx">reject</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>
    <span class="nx">resolve</span><span class="p">(</span><span class="s1">'food is ready'</span><span class="p">);</span>
  <span class="p">}</span>
<span class="p">);</span>
</pre></td></tr></tbody></table></code></pre></div></div>

<p>Using <code class="highlighter-rouge">then</code>, <code class="highlighter-rouge">catch</code> and <code class="highlighter-rouge">finally</code>, we could perform a series of actions based on whether the Promise is resolved (<code class="highlighter-rouge">then</code>) or rejected (<code class="highlighter-rouge">catch</code>) — while <code class="highlighter-rouge">finally</code> allows us to execute code once the Promise is settled, regardless of whether it was resolved or rejected:</p>

<div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
</pre></td><td class="rouge-code"><pre>
<span class="c1">// Let's do cooking</span>

<span class="nx">grocery</span>
  <span class="p">.</span><span class="nx">then</span><span class="p">((</span><span class="nx">value</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>
    <span class="nx">chopping</span>
      <span class="p">.</span><span class="nx">then</span><span class="p">((</span><span class="nx">value</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>
          <span class="nx">cooking</span>
            <span class="p">.</span><span class="nx">then</span><span class="p">((</span><span class="nx">value</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>
              <span class="c1">// Food</span>
            <span class="p">})</span>
      <span class="p">})</span>
  <span class="p">}).</span><span class="k">catch</span><span class="p">((</span><span class="nx">error</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>
    <span class="c1">// it is a holiday, shop closed</span>
  <span class="p">})</span>
  <span class="p">.</span><span class="k">finally</span><span class="p">(()</span> <span class="o">=&gt;</span> <span class="p">{</span>
    <span class="c1">// take water</span>
  <span class="p">});</span>

</pre></td></tr></tbody></table></code></pre></div></div>

<h1 id="async-and-await">async And await</h1>

<p>By contrast, <code class="highlighter-rouge">async</code> and <code class="highlighter-rouge">await</code> are keywords which make synchronous-looking code asynchronous. We use <code class="highlighter-rouge">async</code> when defining a function to signify that it returns a <code class="highlighter-rouge">Promise</code>. Notice how the placement of the <code class="highlighter-rouge">async</code> keyword depends on whether we’re using regular functions or arrow functions:</p>

<div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
</pre></td><td class="rouge-code"><pre>
<span class="k">async</span> <span class="kd">function</span> <span class="nx">doSomethingAsynchronous</span><span class="p">()</span> <span class="p">{</span>
  <span class="c1">// logic</span>
<span class="p">}</span>

<span class="kd">const</span> <span class="nx">doSomethingAsynchronous</span> <span class="o">=</span> <span class="k">async</span> <span class="p">()</span> <span class="o">=&gt;</span> <span class="p">{</span>
  <span class="c1">// logic</span>
<span class="p">};</span>

</pre></td></tr></tbody></table></code></pre></div></div>

<p><code class="highlighter-rouge">await</code>, meanwhile, is used before a Promise. It pauses the execution of an asynchronous function until the Promise is resolved. For example, to await our grocery above, we could write:</p>

<div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
</pre></td><td class="rouge-code"><pre>
<span class="kd">const</span> <span class="nx">grocery</span> <span class="o">=</span> <span class="k">async</span> <span class="p">()</span> <span class="p">{</span>
  <span class="k">try</span> <span class="p">{</span>
    <span class="kd">const</span> <span class="nx">value</span> <span class="o">=</span> <span class="kr">await</span> <span class="s1">'buy the grocery'</span><span class="p">;</span>
    <span class="k">return</span> <span class="nx">value</span>
  <span class="p">}</span> <span class="k">catch</span> <span class="p">(</span><span class="nx">e</span><span class="p">)</span> <span class="p">{</span>
    <span class="kd">const</span> <span class="nx">value</span> <span class="o">=</span> <span class="kr">await</span> <span class="s1">'it is a holiday, shop closed'</span><span class="p">;</span>
    <span class="k">return</span> <span class="nx">value</span>
  <span class="p">}</span>
<span class="p">}</span>

</pre></td></tr></tbody></table></code></pre></div></div>

<p>Then you can still use the same pattern</p>

<div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
</pre></td><td class="rouge-code"><pre>
<span class="c1">// Let's do cooking</span>

<span class="nx">grocery</span>
  <span class="p">.</span><span class="nx">then</span><span class="p">((</span><span class="nx">value</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>
    <span class="c1">// Do Something</span>
  <span class="p">}).</span><span class="k">catch</span><span class="p">((</span><span class="nx">error</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>
    <span class="c1">// it is a holiday, shop closed</span>
  <span class="p">})</span>
  <span class="p">.</span><span class="k">finally</span><span class="p">(()</span> <span class="o">=&gt;</span> <span class="p">{</span>
    <span class="c1">// take water</span>
  <span class="p">});</span>

</pre></td></tr></tbody></table></code></pre></div></div>
