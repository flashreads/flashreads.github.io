<h2 id="what-are-asynchronous-operations-in-javascript">What are Asynchronous Operations in JavaScript?</h2>

<p><img src="https://source.unsplash.com/u2d0BPZFXOY/640x426" /></p>

<p>You may already know that the JavaScript V8 engine executes on a single thread, which means if there are synchronous operations that take longer periods of time, they would inturn block the subsequent synchronous operations. Therefore, JavaScript uses asynchronous operations in order to prevent blocking during code execution.</p>

<p>In the JavaScript engine, we have the following components:</p>

<ul>
  <li>
    <p>Call Stack</p>
  </li>
  <li>
    <p>Event Loop</p>
  </li>
  <li>
    <p>WEB APIs environment</p>
  </li>
  <li>
    <p>Call-back Queue</p>
  </li>
  <li>
    <p>Micro-task Queue</p>
  </li>
</ul>

<p>Whenever there is any asynchronous task, JS moves it to the WEB APIs Environment, for example, when you have an img tag with a very large image in the “src” attribute, this image is not downloaded synchronously, because that would block the thread, instead it is moved into the WEB API Environment where the image is loaded.</p>

<div class="language-html highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
</pre></td><td class="rouge-code"><pre>
<span class="nt">&lt;img</span>  <span class="na">src=</span><span class="s">"largeimg.jpg"</span> <span class="nt">/&gt;</span>

</pre></td></tr></tbody></table></code></pre></div></div>

<p>Now, if you want to do something once the image is loaded, you will need to listen to the image’s ‘load’ event.</p>

<div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
</pre></td><td class="rouge-code"><pre>
<span class="nb">document</span><span class="p">.</span><span class="nx">querySelector</span><span class="p">(</span><span class="s1">'img'</span><span class="p">)</span>
<span class="p">.</span><span class="nx">addEventListener</span><span class="p">(</span><span class="s1">'load'</span><span class="p">,</span> <span class="p">()</span> <span class="o">=&gt;</span>  <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">'Image has been loaded!'</span><span class="p">));</span>

</pre></td></tr></tbody></table></code></pre></div></div>

<p>Now once the image has been loaded, this callback function is still not executed, instead now it is moved into the Callback queue. The callback function waits in the callback queue, the event loop will check for synchronous code, and wait until the call stack is empty. Once the call stack is empty, the event loop will push in a first in callback function into the call stack in one event loop tick. And that is when that call back function is executed.</p>

<p>However, this changes when there are micro-tasks such as Promises. When there is a promise, it is sent to the microtask queue. Microtasks will always have priority over the callbacks and they can and will halt the callbacks until they are executed, event loop will always prioritize microtasks.</p>

<p>This is how the JavaScript Call Stack, Event Loop, Call Back Queue, Microtasks Queue and WEB API Environments work.</p>

<h3 id="an-example">An Example</h3>

<p>Here is a code snippet that can gives more clarity on the sequence of execution in JavaScript:</p>

<div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
</pre></td><td class="rouge-code"><pre>
<span class="c1">//Synchronous Code - Always prioritized over async code</span>

<span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">'Asynchronous TEST start'</span><span class="p">);</span>

<span class="c1">//It is a 0 Second Timer, But a timer is not a microtask</span>

<span class="nx">setTimeout</span><span class="p">(()</span> <span class="o">=&gt;</span>  <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">'0 sec timer'</span><span class="p">),</span> <span class="mi">0</span><span class="p">);</span>

<span class="c1">//Promise is a microtask</span>

<span class="nb">Promise</span><span class="p">.</span><span class="nx">resolve</span><span class="p">(</span><span class="s1">'Resolved promise 1'</span><span class="p">).</span><span class="nx">then</span><span class="p">(</span><span class="nx">res</span>  <span class="o">=&gt;</span>  <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">res</span><span class="p">));</span>

<span class="c1">//2nd promise is a microtask too</span>

<span class="nb">Promise</span><span class="p">.</span><span class="nx">resolve</span><span class="p">(</span><span class="s1">'Resolved promise 2'</span><span class="p">).</span><span class="nx">then</span><span class="p">(</span><span class="nx">res</span>  <span class="o">=&gt;</span> <span class="p">{</span>

<span class="k">for</span> <span class="p">(</span><span class="kd">let</span>  <span class="nx">i</span>  <span class="o">=</span>  <span class="mi">0</span><span class="p">;</span> <span class="nx">i</span>  <span class="o">&lt;</span>  <span class="mi">1000000000</span><span class="p">;</span> <span class="nx">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{}</span> <span class="c1">//very large loop</span>

<span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">res</span><span class="p">);</span>

<span class="p">});</span>  

<span class="c1">//Synchronous Code - Always prioritized over async code</span>

<span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">'Test end'</span><span class="p">);</span>

</pre></td></tr></tbody></table></code></pre></div></div>
