<h1 id="using-callbacks-to-perform-some-task-after-an-async-event-in-java">Using Callbacks to perform some task after an Async event in Java</h1>

<p>Let’s discuss the problem first and then we can understand what a callback is!</p>

<p>Let’s see a code that does some async task which might take some time but we want to do some other work in the meantime. After getting the response or the data been produced, we want to consume the data.</p>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
</pre></td><td class="rouge-code"><pre><span class="kd">class</span> <span class="nc">MyThread</span> <span class="kd">extends</span> <span class="n">Thread</span><span class="o">{</span>
    <span class="nd">@Override</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">run</span><span class="o">()</span> <span class="o">{</span>
        <span class="kd">super</span><span class="o">.</span><span class="na">run</span><span class="o">();</span>
        <span class="c1">// some api calls or async task that might take some time</span>
    <span class="o">}</span>
<span class="o">}</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">Main</span> <span class="o">{</span>
    <span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">main</span><span class="o">(</span><span class="n">String</span><span class="o">[]</span> <span class="n">args</span><span class="o">)</span> <span class="o">{</span>
        <span class="n">MyThread</span> <span class="n">myThread</span> <span class="o">=</span> <span class="k">new</span> <span class="n">MyThread</span><span class="o">();</span>
        <span class="n">myThread</span><span class="o">.</span><span class="na">start</span><span class="o">();</span>
        <span class="c1">// now we dont want to wait, instead we want to initialize the ui with basic components</span>
        <span class="n">initUi</span><span class="o">();</span>
        <span class="c1">// after getting the response from the api, we want to update the ui.</span>
        <span class="c1">// but the code won't wait for that to end and waiting is not a option for us</span>
    <span class="o">}</span>
<span class="o">}</span>
</pre></td></tr></tbody></table></code></pre></div></div>

<p>Now how can we know when the data is ready to consume rather than waiting for it?</p>

<p>Well, that’s where Callback comes in. The word <code class="highlighter-rouge">Callback</code> is self-describing. It is calling back, like instead of going forward, we are going backward! Let’s create two concrete methods <code class="highlighter-rouge">onSuccess()</code> and <code class="highlighter-rouge">onFailure()</code> and let the thread that is running separately, call these methods back to the main thread! We will create an interface and pass an object to the thread.</p>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
</pre></td><td class="rouge-code"><pre><span class="kd">interface</span> <span class="nc">Callback</span><span class="o">{</span>
    <span class="kt">void</span> <span class="nf">onSuccess</span><span class="o">(</span><span class="n">Data</span> <span class="n">data</span><span class="o">);</span> <span class="c1">// method that to be called if the task succeded</span>
    <span class="kt">void</span> <span class="nf">onFailure</span><span class="o">(</span><span class="n">Data</span> <span class="n">data</span><span class="o">);</span> <span class="c1">// method that to be called if the task failed</span>
<span class="o">}</span>
<span class="kd">class</span> <span class="nc">MyThread</span> <span class="kd">extends</span> <span class="n">Thread</span><span class="o">{</span>
    <span class="n">Callback</span> <span class="n">callback</span><span class="o">;</span>
    <span class="n">MyThread</span><span class="o">(</span><span class="n">Callback</span> <span class="n">callback</span><span class="o">){</span>
        <span class="k">this</span><span class="o">.</span><span class="na">callback</span> <span class="o">=</span> <span class="n">callback</span><span class="o">;</span>
    <span class="o">}</span>
    <span class="nd">@Override</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">run</span><span class="o">()</span> <span class="o">{</span>
        <span class="kd">super</span><span class="o">.</span><span class="na">run</span><span class="o">();</span>
        <span class="c1">// some api calls or async task that might take some time</span>
        <span class="k">if</span><span class="o">(</span><span class="n">response</span><span class="o">.</span><span class="na">status</span> <span class="o">==</span> <span class="n">SUCCESS</span><span class="o">)</span><span class="n">callback</span><span class="o">(</span><span class="n">response</span><span class="o">.</span><span class="na">data</span><span class="o">);</span>
        <span class="k">else</span> <span class="nf">callback</span><span class="o">(</span><span class="n">response</span><span class="o">.</span><span class="na">errorMessage</span><span class="o">);</span>
    <span class="o">}</span>
<span class="o">}</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">Main</span> <span class="o">{</span>
    <span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">main</span><span class="o">(</span><span class="n">String</span><span class="o">[]</span> <span class="n">args</span><span class="o">)</span> <span class="o">{</span>
        <span class="n">MyThread</span> <span class="n">myThread</span> <span class="o">=</span> <span class="k">new</span> <span class="n">MyThread</span><span class="o">(</span><span class="k">new</span> <span class="n">Callback</span><span class="o">()</span> <span class="o">{</span> <span class="c1">// passing the</span>
            <span class="nd">@Override</span>
            <span class="kd">public</span> <span class="kt">void</span> <span class="nf">onSuccess</span><span class="o">(</span><span class="n">Data</span> <span class="n">data</span><span class="o">)</span> <span class="o">{</span>
                <span class="n">loadSuccessUi</span><span class="o">(</span><span class="n">data</span><span class="o">);</span>
            <span class="o">}</span>

            <span class="nd">@Override</span>
            <span class="kd">public</span> <span class="kt">void</span> <span class="nf">onFailure</span><span class="o">(</span><span class="n">Data</span> <span class="n">data</span><span class="o">)</span> <span class="o">{</span>
                <span class="n">loadFailureUi</span><span class="o">(</span><span class="n">data</span><span class="o">);</span>
            <span class="o">}</span>
        <span class="o">});</span>
        <span class="n">myThread</span><span class="o">.</span><span class="na">start</span><span class="o">();</span>
        <span class="n">loadUi</span><span class="o">();</span>
        <span class="c1">// now initial ui will be loaded without waiting for the response</span>
        <span class="c1">// when the reponse is ready the ui will be updated</span>
    <span class="o">}</span>
<span class="o">}</span>
</pre></td></tr></tbody></table></code></pre></div></div>

<p>We will give the desired body to onSuccess and onFailure methods and then pass the object to the new thread that will call these methods back to the main thread and pass necessary args.</p>

<p>In short, these two methods are working on the main thread but getting invoked from the seprate thread!</p>
