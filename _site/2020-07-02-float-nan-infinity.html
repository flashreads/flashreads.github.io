<h1 id="nan-and-infinity-in-java">NaN and Infinity in Java</h1>

<p>You may be familiar with the fact that you cannot divide an integer with 0 in Java - it yields <code class="highlighter-rouge">java.lang.ArithmeticException: / by zero</code>.
But what happens when we try to do this with floating point numbers.</p>

<p>Let’s give it a try:</p>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
</pre></td><td class="rouge-code"><pre><span class="kt">int</span> <span class="n">m</span> <span class="o">=</span> <span class="mi">10</span><span class="o">,</span> <span class="n">n</span> <span class="o">=</span> <span class="mi">0</span><span class="o">;</span>

<span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="n">m</span><span class="o">/</span><span class="n">n</span><span class="o">);</span>
<span class="c1">// Exception: java.lang.ArithmeticException: / by zero</span>

<span class="kt">float</span> <span class="n">a</span> <span class="o">=</span> <span class="mf">10.0f</span><span class="o">,</span> <span class="n">b</span> <span class="o">=</span> <span class="mf">0.0f</span><span class="o">;</span>
<span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="n">a</span><span class="o">/</span><span class="n">b</span><span class="o">);</span>
<span class="c1">// Infinity</span>

</pre></td></tr></tbody></table></code></pre></div></div>

<p>Now that is interesting, we didn’t get an exception, but instead, we got something as a result: <code class="highlighter-rouge">Infinity</code>.</p>

<p>If we check out the <code class="highlighter-rouge">Float</code> class, we can see that there are a couple of constants defined in the class:</p>

<ul>
  <li><code class="highlighter-rouge">NaN</code> - A constant holding a Not-a-Number (NaN) value of type float.</li>
  <li><code class="highlighter-rouge">PositiveInfinity</code> - A constant holding the positive infinity of type float.</li>
  <li><code class="highlighter-rouge">NegativeInfinity</code> - A constant holding the negative infinity of type float.</li>
</ul>

<p>What this means is, that some operations in Java may yield values that are not strictly some defined number and behave in a special way.
For example, when we’re diving by <code class="highlighter-rouge">0</code>, we usually say that the result is Infinity. In maths, this has a special meaning, in terms that
Infinity is not a specific number and has a set of rules defined for it. In Java, we can see that there are two types of infinity: positive and negative.</p>

<p>To get a positive infinity, it means that the result of some operation approaches infinite value, but from the positive side on the number axis - for
example if we divide a positive number by 0, we get infinite results but all of them are positive, thus getting positive infinity.
On the other hand, if we divide a negative number by 0, we also get infinite results, but all of them are negative, so negative infinity.</p>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
</pre></td><td class="rouge-code"><pre><span class="kt">float</span> <span class="n">a</span> <span class="o">=</span> <span class="mf">1.0f</span><span class="o">;</span>
<span class="kt">float</span> <span class="n">b</span> <span class="o">=</span> <span class="mf">0.0f</span><span class="o">;</span>

<span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">((</span><span class="n">a</span><span class="o">/</span><span class="n">b</span><span class="o">)</span> <span class="o">==</span> <span class="n">Float</span><span class="o">.</span><span class="na">POSITIVE_INFINITY</span><span class="o">);</span>
<span class="c1">// true</span>

<span class="c1">// if a is negative</span>
<span class="n">a</span> <span class="o">=</span> <span class="o">-</span><span class="mf">1.0f</span><span class="o">;</span>
<span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">((</span><span class="n">a</span><span class="o">/</span><span class="n">b</span><span class="o">)</span> <span class="o">==</span> <span class="n">Float</span><span class="o">.</span><span class="na">POSITIVE_INFINITY</span><span class="o">);</span>
<span class="c1">// false, we should be getting negative infinity</span>

<span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">((</span><span class="n">a</span><span class="o">/</span><span class="n">b</span><span class="o">)</span> <span class="o">==</span> <span class="n">Float</span><span class="o">.</span><span class="na">NEGATIVE_INFINITY</span><span class="o">);</span>
<span class="c1">// true</span>

</pre></td></tr></tbody></table></code></pre></div></div>

<p>But what happens when both of the numbers are <code class="highlighter-rouge">0</code>? In maths, dividing zero by zero yields an undefined result.</p>

<p>In Java we get <code class="highlighter-rouge">NaN</code>. This is also a constant defined in <code class="highlighter-rouge">Float</code> and <code class="highlighter-rouge">Double</code> classes.
If we try to divide zero by zero, we get something that is not a number, so <code class="highlighter-rouge">NaN</code>.</p>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
</pre></td><td class="rouge-code"><pre><span class="kt">float</span> <span class="n">a</span> <span class="o">=</span> <span class="mf">0.0f</span><span class="o">;</span>
<span class="kt">float</span> <span class="n">b</span> <span class="o">=</span> <span class="mf">0.0f</span><span class="o">;</span>
<span class="n">Float</span> <span class="n">c</span> <span class="o">=</span> <span class="n">a</span><span class="o">/</span><span class="n">b</span><span class="o">;</span>

<span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="n">c</span><span class="o">);</span>
<span class="c1">// NaN</span>
<span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="n">c</span> <span class="o">==</span> <span class="n">Float</span><span class="o">.</span><span class="na">NaN</span><span class="o">);</span>
<span class="c1">// false</span>
<span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="n">c</span><span class="o">.</span><span class="na">isNaN</span><span class="o">());</span>
<span class="c1">// true</span>
</pre></td></tr></tbody></table></code></pre></div></div>

<p>Now, this looks weird. Why isn’t the result (<code class="highlighter-rouge">c</code>), which is clearly <code class="highlighter-rouge">NaN</code>, not equal to that constant?</p>

<p>This also comes from maths, where we cannot compare two things that are not numbers. We can only compare something that has 
a clear definition or has a clear value. NaN denotes a mathematically undefined value, and as such we cannot compare it (similar to <code class="highlighter-rouge">NULL</code> in <code class="highlighter-rouge">SQL</code>).</p>

<p>What we <em>can</em> do, is to check whether whatever we got is undefined (Not-a-Number) by using <code class="highlighter-rouge">Float.isNaN()</code> method.</p>

<h2 id="some-notes-on-serialization">Some notes on serialization</h2>

<p>When serializing special care should be taken to serialize these values properly.
If we do naive serialization, we would get an exception:</p>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
</pre></td><td class="rouge-code"><pre><span class="n">Gson</span> <span class="n">gson</span> <span class="o">=</span> <span class="k">new</span> <span class="n">Gson</span><span class="o">();</span>
<span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="n">gson</span><span class="o">.</span><span class="na">toJson</span><span class="o">(</span><span class="k">new</span> <span class="n">SomeObject</span><span class="o">(</span><span class="mf">10.0f</span><span class="o">/</span><span class="mf">0.0f</span><span class="o">)));</span>
<span class="c1">// Throws an exception: java.lang.IllegalArgumentException: Infinity is not a valid double value as per JSON specification. To override this behavior, use GsonBuilder.serializeSpecialFloatingPointValues() method.</span>
</pre></td></tr></tbody></table></code></pre></div></div>

<p>By setting the serialization of these values, we get the following:</p>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
</pre></td><td class="rouge-code"><pre><span class="kd">public</span> <span class="kd">static</span> <span class="kd">class</span> <span class="nc">SomeObject</span> <span class="o">{</span>
    <span class="kd">private</span> <span class="kt">float</span> <span class="n">value</span><span class="o">;</span>

    <span class="kd">public</span> <span class="nf">SomeObject</span><span class="o">(</span><span class="kt">float</span> <span class="n">value</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">this</span><span class="o">.</span><span class="na">value</span> <span class="o">=</span> <span class="n">value</span><span class="o">;</span>
    <span class="o">}</span>

    <span class="kd">public</span> <span class="kt">float</span> <span class="nf">getValue</span><span class="o">()</span> <span class="o">{</span>
        <span class="k">return</span> <span class="n">value</span><span class="o">;</span>
    <span class="o">}</span>

    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">setValue</span><span class="o">(</span><span class="kt">float</span> <span class="n">value</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">this</span><span class="o">.</span><span class="na">value</span> <span class="o">=</span> <span class="n">value</span><span class="o">;</span>
    <span class="o">}</span>
<span class="o">}</span>

<span class="o">...</span>

<span class="n">GsonBuilder</span> <span class="n">builder</span> <span class="o">=</span> <span class="k">new</span> <span class="n">GsonBuilder</span><span class="o">();</span>
<span class="n">builder</span><span class="o">.</span><span class="na">serializeSpecialFloatingPointValues</span><span class="o">();</span>
<span class="n">Gson</span> <span class="n">gson</span> <span class="o">=</span> <span class="n">builder</span><span class="o">.</span><span class="na">create</span><span class="o">();</span>

<span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="n">gson</span><span class="o">.</span><span class="na">toJson</span><span class="o">(</span><span class="k">new</span> <span class="n">SomeObject</span><span class="o">(</span><span class="mf">10.0f</span><span class="o">/</span><span class="mf">0.0f</span><span class="o">)));</span>
<span class="c1">// {"value":Infinity}</span>

<span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="n">gson</span><span class="o">.</span><span class="na">toJson</span><span class="o">(</span><span class="k">new</span> <span class="n">SomeObject</span><span class="o">(-</span><span class="mf">10.0f</span><span class="o">/</span><span class="mf">0.0f</span><span class="o">)));</span>
<span class="c1">// {"value":-Infinity}</span>

<span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="n">gson</span><span class="o">.</span><span class="na">toJson</span><span class="o">(</span><span class="k">new</span> <span class="n">SomeObject</span><span class="o">(</span><span class="mf">0.0f</span><span class="o">/</span><span class="mf">0.0f</span><span class="o">)));</span>
<span class="c1">// {"value":NaN}</span>
</pre></td></tr></tbody></table></code></pre></div></div>

<p>Be careful though, these values may not be recognized by some JSON parsers and you may get some unpredictable results, such as
the values to be converted to <code class="highlighter-rouge">String</code> or getting an error while parsing.</p>
