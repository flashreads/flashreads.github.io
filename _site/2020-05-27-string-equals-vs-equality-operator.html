<h1 id="java-string-equals-vs-the--equality-operator">Java String equals vs the (==) equality operator</h1>

<blockquote>
  <p><em>TL;DR;</em> Always use <code class="highlighter-rouge">String.equals</code> or <code class="highlighter-rouge">Objects.equals</code> on strings. <code class="highlighter-rouge">==</code> compares
memory locations, not the actual content of the string. This is important as
string literals are not kept in the heap and different string objects on the
heap will have different memory locations even if they have the same content.</p>
</blockquote>

<p>Java is a bit weird when it comes to string comparison. I remember me getting
stumped when I first needed to compare strings in Java. I used the <code class="highlighter-rouge">==</code> comparison
operator and got some weird results that I didn’t expect, for example:</p>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
</pre></td><td class="rouge-code"><pre><span class="k">if</span><span class="o">(</span><span class="s">"foo"</span> <span class="o">==</span> <span class="s">"foo"</span><span class="o">)</span> <span class="o">{</span>
    <span class="c1">// This always gets through</span>
<span class="o">}</span>

<span class="c1">// However this</span>
<span class="k">if</span><span class="o">(</span><span class="n">myVariable</span> <span class="o">==</span> <span class="s">"foo"</span><span class="o">)</span> <span class="o">{</span>
    <span class="c1">// would sometimes works, but other times will not work.</span>
<span class="o">}</span>
</pre></td></tr></tbody></table></code></pre></div></div>

<p>So what is going on?</p>

<p>It all stems from the way Java handles variables and constants in your code. 
Maybe you’ve heard of <a href="https://docs.oracle.com/javase/tutorial/java/nutsandbolts/datatypes.html" title="I thought of referencing the language specification for string literals, but that is just more confusing">string literals</a>. Literals in Java are primitive data types (like <code class="highlighter-rouge">int</code>,
<code class="highlighter-rouge">float</code>, <code class="highlighter-rouge">boolean</code> and sometimes <code class="highlighter-rouge">String</code>) which are not instantiated using the <code class="highlighter-rouge">new</code> keyword, like these
<code class="highlighter-rouge">int i = 10;</code> or <code class="highlighter-rouge">String str = "foo";</code>. Notice that there is no <code class="highlighter-rouge">new</code> keyword before any of these.</p>

<p>When defined like this, Java considers these values as constants and keeps them
in a special place in the jvm memory used for constants. The idea behind this is
a form of optimization - whenever Java encounters the same value in the code, it does
not allocate new memory on the heap, but instead will reuse the value that already
has in the static memory.</p>

<p>However, if we create new values using the <code class="highlighter-rouge">new</code> keyword, we’re instructing the
jvm to actually allocate new slot on the heap for our value: <code class="highlighter-rouge">String str = new String("foo");</code>.
By now you may have some idea of what is going on:</p>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
</pre></td><td class="rouge-code"><pre><span class="n">String</span> <span class="n">a</span> <span class="o">=</span> <span class="s">"foo"</span><span class="o">;</span>  <span class="c1">// this is a literal and goes in the static memory</span>
<span class="n">String</span> <span class="n">b</span> <span class="o">=</span> <span class="s">"foo"</span><span class="o">;</span>  <span class="c1">// also a literal, with same value as 'a', so 'b' points to the same</span>
                   <span class="c1">// memory location as 'a'</span>

<span class="n">String</span> <span class="n">c</span> <span class="o">=</span> <span class="k">new</span> <span class="n">String</span><span class="o">(</span><span class="s">"foo"</span><span class="o">)</span>  <span class="c1">// We allocate "foo" on the heap, although it has the</span>
                              <span class="c1">// same value as 'a' and 'b', it is in a different</span>
                              <span class="c1">// memory location - namely on the heap</span>
</pre></td></tr></tbody></table></code></pre></div></div>

<p>When doing <code class="highlighter-rouge">==</code> comparison in Java, by default the jvm compares <em>memory locations</em> - it will
compare whether the memory address of the two objects is the same, and if it is, then the
objects must be the same.</p>

<p>But the strings allocated with <code class="highlighter-rouge">new</code> will always get new locations on the Heap, and <code class="highlighter-rouge">==</code>
will get two different memory locations and will evaluate to <code class="highlighter-rouge">false</code>.</p>

<p>The way around this is to use <a href="https://docs.oracle.com/javase/7/docs/api/java/lang/String.html#equals(java.lang.Object)"><code class="highlighter-rouge">String.equals</code></a> method.
This method compares the string content, and <em>not</em> the memory addresses. And that is what we want
when comparing strings.</p>

<p>Here is some weirdness and examples on how to compare string and what not to do:</p>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
</pre></td><td class="rouge-code"><pre>
<span class="n">String</span> <span class="n">a</span> <span class="o">=</span> <span class="s">"foo"</span><span class="o">;</span>
<span class="n">String</span> <span class="n">b</span> <span class="o">=</span> <span class="s">"foo"</span><span class="o">;</span> 

<span class="n">a</span> <span class="o">==</span> <span class="n">b</span>  <span class="c1">// -&gt; true, but don't do this.</span>

<span class="n">a</span><span class="o">.</span><span class="na">equals</span><span class="o">(</span><span class="n">b</span><span class="o">)</span>  <span class="c1">// true. Do this instead.</span>

<span class="n">String</span> <span class="n">a</span> <span class="o">=</span> <span class="s">"foo"</span><span class="o">;</span>
<span class="n">String</span> <span class="n">b</span> <span class="o">=</span> <span class="k">new</span> <span class="n">String</span><span class="o">(</span><span class="s">"foo"</span><span class="o">)</span>

<span class="n">a</span> <span class="o">==</span> <span class="n">b</span>  <span class="c1">// false. One is a string literal, the other is a regular object on the heap.</span>

<span class="n">a</span><span class="o">.</span><span class="na">equals</span><span class="o">(</span><span class="n">b</span><span class="o">)</span> <span class="c1">// true. Compares the content: "foo" is equal to "foo".</span>


<span class="c1">// Alternative approach, with Objects.equals</span>
<span class="n">Objects</span><span class="o">.</span><span class="na">equals</span><span class="o">(</span><span class="s">"foo"</span><span class="o">,</span> <span class="s">"foo"</span><span class="o">)</span>               <span class="c1">// true</span>
<span class="n">Objects</span><span class="o">.</span><span class="na">equals</span><span class="o">(</span><span class="s">"foo"</span><span class="o">,</span> <span class="kc">null</span><span class="o">)</span>                <span class="c1">// true. Protects us from null pointer dereferencing.</span>
<span class="n">Objects</span><span class="o">.</span><span class="na">equals</span><span class="o">(</span><span class="s">"foo"</span><span class="o">,</span> <span class="k">new</span> <span class="n">String</span><span class="o">(</span><span class="s">"foo"</span><span class="o">))</span>   <span class="c1">// true</span>

</pre></td></tr></tbody></table></code></pre></div></div>

<p>So basically we want to use <code class="highlighter-rouge">String.equals</code> to compare the content of the strings. However
in some cases we may run into problems, namely in the cases when we try to call <code class="highlighter-rouge">equals</code> from
a variable that is <code class="highlighter-rouge">null</code>:</p>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
</pre></td><td class="rouge-code"><pre><span class="n">String</span> <span class="n">a</span> <span class="o">=</span> <span class="kc">null</span><span class="o">;</span>

<span class="n">a</span><span class="o">.</span><span class="na">equals</span><span class="o">(</span><span class="s">"foo"</span><span class="o">);</span>  <span class="c1">// NullPointerException</span>

</pre></td></tr></tbody></table></code></pre></div></div>

<p>So in cases when we’re comparing with a literal, always call equals from the literal:</p>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
</pre></td><td class="rouge-code"><pre><span class="n">String</span> <span class="n">a</span> <span class="o">=</span> <span class="kc">null</span><span class="o">;</span>

<span class="s">"foo"</span><span class="o">.</span><span class="na">equals</span><span class="o">(</span><span class="n">a</span><span class="o">)</span>   <span class="c1">// false. No exception was thrown.</span>
</pre></td></tr></tbody></table></code></pre></div></div>

<p>Alternatively you can use <a href="https://docs.oracle.com/javase/8/docs/api/java/util/Objects.html#equals-java.lang.Object-java.lang.Object-"><code class="highlighter-rouge">Objects.equals</code></a> (available from java 1.7).
This does what we want and takes care of the <code class="highlighter-rouge">null</code> values.</p>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
</pre></td><td class="rouge-code"><pre><span class="n">String</span> <span class="n">a</span> <span class="o">=</span> <span class="kc">null</span><span class="o">;</span>

<span class="n">Objects</span><span class="o">.</span><span class="na">equals</span><span class="o">(</span><span class="n">a</span><span class="o">,</span> <span class="s">"foo"</span><span class="o">)</span> <span class="c1">// false. no exception thrown.</span>
</pre></td></tr></tbody></table></code></pre></div></div>
